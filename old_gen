import qrcode
import os
import time
from PIL import Image

def generate_qr_code(data, output_dir="qr_codes", unique_id=None):
    """Generate a QR code with just the animal name and save it as an image."""
    os.makedirs(output_dir, exist_ok=True)
    
    qr_data = data  # Use only the animal name
    
    qr = qrcode.QRCode(
        version=1,
        error_correction=qrcode.constants.ERROR_CORRECT_L,
        box_size=10,
        border=4,
    )
    qr.add_data(qr_data)
    qr.make(fit=True)
    
    img = qr.make_image(fill="black", back_color="white")
    img_path = os.path.join(output_dir, f"{qr_data}.png")
    img.save(img_path)
    print(f"QR Code saved: {img_path}")
    return img_path

def create_print_sheet(animals, outline_dir="outlines", output_file="print_sheet.png", sheet_size=(2480, 3508)):
    """Create a print sheet combining QR codes with their outlines."""
    os.makedirs("print_sheets", exist_ok=True)
    sheet = Image.new("RGB", sheet_size, "white")
    
    qr_output_dir = "qr_codes"
    
    cols = 3  # Number of columns per row
    rows = len(animals) // cols + (1 if len(animals) % cols else 0)
    
    qr_size = 800  # Adjust QR code size
    outline_size = (2000, 2000)  # Resize outline images
    
    qr_x, qr_y = 50, 50  # QR code position in the top-left corner
    
    for i, animal in enumerate(animals):
        qr_path = generate_qr_code(animal)
        outline_path = os.path.join(outline_dir, f"{animal}.png")
        
        if os.path.exists(outline_path):
            outline = Image.open(outline_path).convert("RGBA").resize(outline_size)
        else:
            outline = Image.new("RGBA", outline_size, "white")  # Placeholder if missing
        
        qr = Image.open(qr_path).resize((qr_size, qr_size))
        
        # Create a new sheet with the outline centered
        combined = Image.new("RGBA", sheet_size, "white")
        outline_x = (sheet_size[0] - outline_size[0]) // 2
        outline_y = (sheet_size[1] - outline_size[1]) // 2
        combined.paste(outline, (outline_x, outline_y))
        
        # Place the QR code in the top-left corner
        combined.paste(qr, (qr_x, qr_y))
        
        output_path = os.path.join("print_sheets", f"print_sheet_{animal}.png")
        combined.save(output_path)
        print(f"Print sheet saved: {output_path}")

if __name__ == "__main__":
    animals = ["frog", "hedgehog", "lion", "tiger", "elephant"]  # Add more as needed
    create_print_sheet(animals)
